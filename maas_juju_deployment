#UNDER CONSTRUCTION...... 

Loading   ]]]]]]]]]43%_______________


asuming your user is john and your password is 12345678


# Install OS Ubuntu 18.04 on your server

sudo apt update && apt upgrade

# configure network (chose these or use your ip's)

#go root
sudo su -

#edit file with configuration below
vim /etc/netplan/50-cloud-init.yaml


network:
  version: 2
  renderer: networkd
  ethernets:
    eno0:
      dhcp4: no
      
  bridges:
    br0:
      addresses: [ 10.10.1.126/24 ]
      gateway4: 10.10.1.1
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
      interfaces:
        - eno1
    br1:
      addresses: [ 192.168.1.50/24 ]
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
        

netplan apply

#enable ip forwarding

echo 'net.ipv4.ip_forward=1' >> /etc/sysctl.conf
systemctl -p


#create iptables config rc.local

vim  /etc/rc.local

#!/bin/sh -e
/sbin/iptables -t nat -A POSTROUTING -o br0 -j MASQUERADE
/sbin/iptables -A FORWARD -i br0 -o br1 -m state --state RELATED,ESTABLISHED -j ACCEPT
/sbin/iptables -A FORWARD -i br1 -o br0 -j ACCEPT
exit 0

chmod +x rc.local

./rc.local

#check iptables config

iptables -vnL

#Instal KVM
sudo apt-get install qemu-kvm libvirt-bin virtinst bridge-utils cpu-checker

virsh net-list
virsh net-destroy default
virsh undefine default


#PATH Create VM from .img file


#download ubuntu img

wget http://releases.ubuntu.com/18.04.3/ubuntu-18.04.3-desktop-amd64.iso

#create VM for MAAS

virt-install --name maas --ram 8000 --disk path=./vmdisk/maas.qcow2,size=10 --vcpus 1 --os-type linux --os-variant generic --network bridge=br0 --network bridge=br1 --graphics vnc --console pty,target_type=serial --cdrom '/home/matrix/ubuntu-18.04.3-live-server-amd64.iso'

#install ubutnu

#check VM maas ip with mac corelation

virsh domiflist maas & arp -n

#connect to maas with VNC

#configuring maas 

sudo apt update && sudo apt upgrade

#config networks on maas VM

vim /etc/netplan/50-cloud-init.yaml

network:
  ethernets:
    ens3:
      addresses: [ 10.10.1.128/24 ]
      gateway4: 10.10.1.1 
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]     
    ens4:        
      addresses: [ 192.168.1.51/24 ] 


netplan apply

#exit and go back on server

exit

#generate ssh-key

ssh-keygen

#leave blank when asked for options
#copy ssh key to MAAS vm

ssh-copy-id root@10.10.1.128

#install MAAS latest version


sudo apt-get dist-upgrade
sudo apt-get install openssh-server vlan
sudo add-apt-repository ppa:maas/stable -y
sudo apt-get update

sudo apt-get install maas maas-dns maas-dhcp maas-proxy -y

#setap maas-rack-controller with http://10.10.1.128:5240/MAAS

sudo dpkg-reconfigure maas-rack-controller

http://10.10.1.128:5240/MAAS

##setap maas-region-controller ith 192.168.1.51

sudo dpkg-reconfigure maas-region-controller

192.168.1.51

#install libvirt on maas 

sudo apt -y install libvirt-bin

#create maas user

sudo mkdir -p /home/maas
sudo chown maas:maas /home/maas
sudo chsh -s /bin/bash maas
sudo -u maas ssh-keygen
sudo -u maas -i ssh-copy-id john@10.10.1.126

#use your user john password. in this case "12345678"

#check connection with KVM on server(it should list VM's)

sudo -u maas virsh -c qemu+ssh://john@10.10.1.126/system list --all  #ip of your server

#Install Juju client on server

sudo snap install juju --classic

#create VM for Juju controller

virt-install --name juju2 --memory 4048 --vcpus 1 --disk path=/home/matrix/vmdisk/juju2.qcow2,size=50 --network bridge=br1 --graphics vnc,listen=0.0.0.0 --pxe --noautoconsole --boot networ

#Go to http://192.168.1.51:5240/MAAS/machines and commistion the machine found by maas, rename it juju.maas and put tag to juju

#Adding in juju a mass cloud with .yaml file

vim maas-cloud.yaml

#insert next configuration but first copy your maas-oauth api key from maas web interface 

clouds:
  maas-cloud:
    type: maas
    auth-types: [oauth1]
    endpoint: http://10.10.1.128:5240/MAAS #maas ip

credentials:
  maas-cloud:
    admin:
      auth-type: oauth1
      maas-oauth: XCGqbTMaUgFPmGZmzK:qDVn4Zmc5PV5qfguFJ:6Q45keyuCSzwcrZzAFJtv435cRpLgcxQ     #change with your api key
      
      
#add cloud controller config

juju add-cloud maas-cloud maas-cloud.yaml

#add maas-cloud credentials

juju add-credential maas-cloud -f maas-cloud.yaml

#Bootstrap juju controler on juju VM

juju bootstrap --constraints tags=juju maas-cloud maas-controller

#Create the model

juju add-model mymass maas-cloud
juju add-cloud maas-cloud maas-cloud.yaml --controller lxc-controller
juju add-model openstack-maas maas-cloud









